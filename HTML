<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- ğŸ”§ Titre du site : modifie ici -->
  <title>CreateShorts â€” GÃ©nÃ©rateur de Shorts YouTube</title>

  <!-- ğŸ”— Lien vers ton fichier CSS -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- ========================== -->
  <!-- ======== HEADER ========= -->
  <!-- ========================== -->
  <header>
    <div class="container">
      <h1>CreateShorts</h1>
      <p class="tagline">
        DÃ©coupe rapidement un segment d'une longue vidÃ©o YouTube â†’ crÃ©e un short.
        <strong>Essai gratuit : 3 crÃ©ations</strong>.
      </p>
    </div>
  </header>

  <!-- ========================== -->
  <!-- ======== MAIN ============ -->
  <!-- ========================== -->
  <main class="container">
    <!-- SECTION 1 : Charger la vidÃ©o -->
    <section class="panel">
      <h2>1. Charger une vidÃ©o YouTube</h2>

      <label for="youtubeUrl">URL YouTube :</label>
      <input id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=XXXXXXXXXXX" />

      <div class="row">
        <button id="loadBtn" class="btn">Charger la vidÃ©o</button>
        <div id="trialInfo" class="small muted">
          Essai gratuit : <span id="trialCount">3</span> restants
        </div>
      </div>

      <!-- Zone du lecteur vidÃ©o -->
      <div id="playerWrap" class="player-wrap hidden" aria-hidden="true">
        <div id="player"></div>

        <div class="player-controls">
          <label>DÃ©but (en secondes ou mm:ss)</label>
          <input id="startInput" placeholder="0" />

          <label>Fin (en secondes ou mm:ss)</label>
          <input id="endInput" placeholder="15" />

          <div class="row">
            <button id="previewBtn" class="btn">PrÃ©visualiser</button>
            <button id="stopPreviewBtn" class="btn secondary">Stop</button>
          </div>

          <p class="small muted">
            ğŸ”¹ Astuce : choisis un extrait de 10 Ã  60 secondes maximum.
          </p>
        </div>
      </div>
    </section>

    <!-- SECTION 2 : Export / Paiement -->
    <section class="panel">
      <h2>2. CrÃ©er ton short</h2>
      <p class="small">
        Clique sur <strong>CrÃ©er / Exporter</strong> pour gÃ©nÃ©rer ton short.
        Tu as droit Ã  3 crÃ©ations gratuites, puis abonnement Ã  <strong>2 â‚¬ / mois</strong>.
      </p>

      <div class="row">
        <button id="exportBtn" class="btn primary">CrÃ©er / Exporter</button>
        <div id="statusMsg" class="small muted"></div>
      </div>

      <!-- Paywall (s'affiche aprÃ¨s 3 essais) -->
      <div id="paywall" class="paywall hidden">
        <p class="muted">
          Ton essai gratuit est terminÃ© ğŸ˜¢<br>
          Pour continuer Ã  utiliser CreateShorts, abonne-toi :
        </p>

       <a id="paypalBtn"
   class="btn paypal"
   href="https://www.paypal.com/paypalme/AvaGrassia/2EUR"
   target="_blank"
   rel="noopener noreferrer">
   ğŸ’¸ Sâ€™abonner â€” 2 â‚¬ / mois
</a>


        <p class="small muted">
          (Ce lien ouvre ton PayPal. Lâ€™abonnement doit Ãªtre gÃ©rÃ© manuellement ou via webhook sur ton backend.)
        </p>
      </div>
    </section>

    <!-- SECTION 3 : Historique -->
    <section class="panel">
      <h2>3. Historique local</h2>
      <ul id="jobsList" class="jobs-list small muted">
        <li>Aucun short crÃ©Ã© pour le moment.</li>
      </ul>
    </section>

    <!-- SECTION 4 : Mentions -->
    <section class="panel footer-note">
      <h3>Remarques importantes</h3>
      <ul class="small muted">
        <li>Ce site ne tÃ©lÃ©charge pas directement les vidÃ©os YouTube â€” il faut un serveur pour gÃ©nÃ©rer le short.</li>
        <li>Le traitement rÃ©el (dÃ©coupe/encodage) doit respecter les conditions d'utilisation de YouTube.</li>
        <li>Ce code gÃ¨re seulement lâ€™interface (front-end) et le paiement.</li>
      </ul>
    </section>
  </main>

  <!-- ========================== -->
  <!-- ========= FOOTER ========= -->
  <!-- ========================== -->
  <footer>
    <div class="container small muted">
      Â© <span id="year"></span> CreateShorts â€” Tous droits rÃ©servÃ©s.
    </div>
  </footer>

  <!-- ========================== -->
  <!-- === SCRIPTS JAVASCRIPT === -->
  <!-- ========================== -->

  <!-- API YouTube pour intÃ©grer le lecteur -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // === Initialisation ===
    document.getElementById('year').textContent = new Date().getFullYear();

    // === Variables ===
    const qs = (sel) => document.querySelector(sel);
    const TRIAL_KEY = 'shorts_trial_v1';
    const MAX_TRIAL = 3;

    // === Fonctions ===
    function getTrial() {
      const value = localStorage.getItem(TRIAL_KEY);
      return value === null ? MAX_TRIAL : Number(value);
    }

    function setTrial(n) {
      localStorage.setItem(TRIAL_KEY, n);
      qs('#trialCount').textContent = n;
    }

    function extractId(url) {
      const reg = /(?:v=|youtu\.be\/|embed\/)([A-Za-z0-9_-]{11})/;
      const m = url.match(reg);
      return m ? m[1] : null;
    }

    let ytPlayer, videoId;

    // === Charger la vidÃ©o ===
    qs('#loadBtn').addEventListener('click', () => {
      const url = qs('#youtubeUrl').value.trim();
      const id = extractId(url);
      if (!id) {
        alert('âŒ URL YouTube invalide');
        return;
      }
      videoId = id;

      qs('#playerWrap').classList.remove('hidden');

      if (ytPlayer) ytPlayer.destroy();

      ytPlayer = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: id,
        playerVars: { controls: 1, rel: 0 }
      });
    });

    // === PrÃ©visualisation ===
    function parseTime(t) {
      if (!t) return 0;
      if (t.includes(':')) {
        const [m, s] = t.split(':').map(Number);
        return m * 60 + s;
      }
      return Number(t);
    }

    let loopInterval;

    qs('#previewBtn').addEventListener('click', () => {
      if (!ytPlayer) return alert('Charge une vidÃ©o avant.');
      const start = parseTime(qs('#startInput').value);
      const end = parseTime(qs('#endInput').value);
      if (end <= start) return alert('La fin doit Ãªtre > au dÃ©but.');

      ytPlayer.seekTo(start);
      ytPlayer.playVideo();

      clearInterval(loopInterval);
      loopInterval = setInterval(() => {
        if (ytPlayer.getCurrentTime() >= end) ytPlayer.seekTo(start);
      }, 300);
    });

    qs('#stopPreviewBtn').addEventListener('click', () => {
      if (ytPlayer) ytPlayer.pauseVideo();
      clearInterval(loopInterval);
    });

    // === CrÃ©er / Exporter ===
    qs('#exportBtn').addEventListener('click', () => {
      let trial = getTrial();
      if (trial <= 0) {
        qs('#paywall').classList.remove('hidden');
        return;
      }

      const start = parseTime(qs('#startInput').value);
      const end = parseTime(qs('#endInput').value);

      if (!videoId) return alert('Aucune vidÃ©o chargÃ©e.');
      if (end <= start) return alert('La fin doit Ãªtre supÃ©rieure au dÃ©but.');

      // Simule l'envoi au serveur
      const job = {
        videoId,
        start,
        end,
        date: new Date().toLocaleString()
      };

      // Sauvegarde locale
      const list = JSON.parse(localStorage.getItem('shorts_jobs') || '[]');
      list.unshift(job);
      localStorage.setItem('shorts_jobs', JSON.stringify(list));

      // Met Ã  jour la liste
      const ul = qs('#jobsList');
      const li = document.createElement('li');
      li.textContent = `âœ… ${videoId} (${start}s â†’ ${end}s)`;
      ul.prepend(li);

      // DÃ©crÃ©mente l'essai
      trial--;
      setTrial(trial);

      if (trial <= 0) {
        qs('#paywall').classList.remove('hidden');
      }
    });

    // === Affiche essais restants au chargement ===
    setTrial(getTrial());
  </script>
</body>
</html>
