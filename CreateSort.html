<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- üîß Titre du site : modifie ici -->
  <title>CreateShorts ‚Äî G√©n√©rateur de Shorts YouTube</title>

  <!-- üîó Lien vers ton fichier CSS -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- ========================== -->
  <!-- ======== HEADER ========= -->
  <!-- ========================== -->
  <header>
    <div class="container">
      <h1>CreateShorts</h1>
      <p class="tagline">
        D√©coupe rapidement un segment d'une longue vid√©o YouTube ‚Üí cr√©e un short.
        <strong>Essai gratuit : 3 cr√©ations</strong>.
      </p>
    </div>
  </header>

  <!-- ========================== -->
  <!-- ======== MAIN ============ -->
  <!-- ========================== -->
  <main class="container">
    <!-- SECTION 1 : Charger la vid√©o -->
    <section class="panel">
      <h2>1. Charger une vid√©o YouTube</h2>

      <label for="youtubeUrl">URL YouTube :</label>
      <input id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=XXXXXXXXXXX" />

      <div class="row">
        <button id="loadBtn" class="btn">Charger la vid√©o</button>
        <div id="trialInfo" class="small muted">
          Essai gratuit : <span id="trialCount">3</span> restants
        </div>
      </div>

      <!-- Zone du lecteur vid√©o -->
      <div id="playerWrap" class="player-wrap hidden" aria-hidden="true">
        <div id="player"></div>

        <div class="player-controls">
          <label>D√©but (en secondes ou mm:ss)</label>
          <input id="startInput" placeholder="0" />

          <label>Fin (en secondes ou mm:ss)</label>
          <input id="endInput" placeholder="15" />

          <div class="row">
            <button id="previewBtn" class="btn">Pr√©visualiser</button>
            <button id="stopPreviewBtn" class="btn secondary">Stop</button>
          </div>

          <p class="small muted">
            üîπ Astuce : choisis un extrait de 10 √† 60 secondes maximum.
          </p>
        </div>
      </div>
    </section>

    <!-- SECTION 2 : Export / Paiement -->
    <section class="panel">
      <h2>2. Cr√©er ton short</h2>
      <p class="small">
        Clique sur <strong>Cr√©er / Exporter</strong> pour g√©n√©rer ton short.
        Tu as droit √† 3 cr√©ations gratuites, puis abonnement √† <strong>2 ‚Ç¨ / mois</strong>.
      </p>

      <div class="row">
        <button id="exportBtn" class="btn primary">Cr√©er / Exporter</button>
        <div id="statusMsg" class="small muted"></div>
      </div>

      <!-- Paywall (s'affiche apr√®s 3 essais) -->
      <div id="paywall" class="paywall hidden">
        <p class="muted">
          Ton essai gratuit est termin√© üò¢<br>
          Pour continuer √† utiliser CreateShorts, abonne-toi :
        </p>

       <a id="paypalBtn"
   class="btn paypal"
   href="https://www.paypal.com/paypalme/AvaGrassia/2EUR"
   target="_blank"
   rel="noopener noreferrer">
   üí∏ S‚Äôabonner ‚Äî 2 ‚Ç¨ / mois
</a>


        <p class="small muted">
          (Ce lien ouvre ton PayPal. L‚Äôabonnement doit √™tre g√©r√© manuellement ou via webhook sur ton backend.)
        </p>
      </div>
    </section>

    <!-- SECTION 3 : Historique -->
    <section class="panel">
      <h2>3. Historique local</h2>
      <ul id="jobsList" class="jobs-list small muted">
        <li>Aucun short cr√©√© pour le moment.</li>
      </ul>
    </section>

    <!-- SECTION 4 : Mentions -->
    <section class="panel footer-note">
      <h3>Remarques importantes</h3>
      <ul class="small muted">
        <li>Ce site ne t√©l√©charge pas directement les vid√©os YouTube ‚Äî il faut un serveur pour g√©n√©rer le short.</li>
        <li>Le traitement r√©el (d√©coupe/encodage) doit respecter les conditions d'utilisation de YouTube.</li>
        <li>Ce code g√®re seulement l‚Äôinterface (front-end) et le paiement.</li>
      </ul>
    </section>
  </main>

  <!-- ========================== -->
  <!-- ========= FOOTER ========= -->
  <!-- ========================== -->
  <footer>
    <div class="container small muted">
      ¬© <span id="year"></span> CreateShorts ‚Äî Tous droits r√©serv√©s.
    </div>
  </footer>

  <!-- ========================== -->
  <!-- === SCRIPTS JAVASCRIPT === -->
  <!-- ========================== -->

  <!-- API YouTube pour int√©grer le lecteur -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // === Initialisation ===
    document.getElementById('year').textContent = new Date().getFullYear();

    // === Variables ===
    const qs = (sel) => document.querySelector(sel);
    const TRIAL_KEY = 'shorts_trial_v1';
    const MAX_TRIAL = 3;

    // === Fonctions ===
    function getTrial() {
      const value = localStorage.getItem(TRIAL_KEY);
      return value === null ? MAX_TRIAL : Number(value);
    }

    function setTrial(n) {
      localStorage.setItem(TRIAL_KEY, n);
      qs('#trialCount').textContent = n;
    }

    function extractId(url) {
      const reg = /(?:v=|youtu\.be\/|embed\/)([A-Za-z0-9_-]{11})/;
      const m = url.match(reg);
      return m ? m[1] : null;
    }

    let ytPlayer, videoId;

    // === Charger la vid√©o ===
    qs('#loadBtn').addEventListener('click', () => {
      const url = qs('#youtubeUrl').value.trim();
      const id = extractId(url);
      if (!id) {
        alert('‚ùå URL YouTube invalide');
        return;
      }
      videoId = id;

      qs('#playerWrap').classList.remove('hidden');

      if (ytPlayer) ytPlayer.destroy();

      ytPlayer = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: id,
        playerVars: { controls: 1, rel: 0 }
      });
    });

    // === Pr√©visualisation ===
    function parseTime(t) {
      if (!t) return 0;
      if (t.includes(':')) {
        const [m, s] = t.split(':').map(Number);
        return m * 60 + s;
      }
      return Number(t);
    }

    let loopInterval;

    qs('#previewBtn').addEventListener('click', () => {
      if (!ytPlayer) return alert('Charge une vid√©o avant.');
      const start = parseTime(qs('#startInput').value);
      const end = parseTime(qs('#endInput').value);
      if (end <= start) return alert('La fin doit √™tre > au d√©but.');

      ytPlayer.seekTo(start);
      ytPlayer.playVideo();

      clearInterval(loopInterval);
      loopInterval = setInterval(() => {
        if (ytPlayer.getCurrentTime() >= end) ytPlayer.seekTo(start);
      }, 300);
    });

    qs('#stopPreviewBtn').addEventListener('click', () => {
      if (ytPlayer) ytPlayer.pauseVideo();
      clearInterval(loopInterval);
    });

    // === Cr√©er / Exporter ===
    qs('#exportBtn').addEventListener('click', () => {
      let trial = getTrial();
      if (trial <= 0) {
        qs('#paywall').classList.remove('hidden');
        return;
      }

      const start = parseTime(qs('#startInput').value);
      const end = parseTime(qs('#endInput').value);

      if (!videoId) return alert('Aucune vid√©o charg√©e.');
      if (end <= start) return alert('La fin doit √™tre sup√©rieure au d√©but.');

      // Simule l'envoi au serveur
      const job = {
        videoId,
        start,
        end,
        date: new Date().toLocaleString()
      };

      // Sauvegarde locale
      const list = JSON.parse(localStorage.getItem('shorts_jobs') || '[]');
      list.unshift(job);
      localStorage.setItem('shorts_jobs', JSON.stringify(list));

      // Met √† jour la liste
      const ul = qs('#jobsList');
      const li = document.createElement('li');
      li.textContent = `‚úÖ ${videoId} (${start}s ‚Üí ${end}s)`;
      ul.prepend(li);

      // D√©cr√©mente l'essai
      trial--;
      setTrial(trial);

      if (trial <= 0) {
        qs('#paywall').classList.remove('hidden');
      }
    });

    // === Affiche essais restants au chargement ===
    setTrial(getTrial());
  </script>
</body>
</html>


